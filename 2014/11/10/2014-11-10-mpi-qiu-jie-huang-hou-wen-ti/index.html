<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>mpi 求解皇后问题 | ylw Home</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="一直好奇，怎么用slave模型知道从属线程是否已经结束了分发给他的任务，然后当总认为还没有结束时，主线程可以再次给他分配任务。">
<meta property="og:type" content="article">
<meta property="og:title" content="mpi 求解皇后问题">
<meta property="og:url" content="http://ylwhere.tk/2014/11/10/2014-11-10-mpi-qiu-jie-huang-hou-wen-ti/index.html">
<meta property="og:site_name" content="ylw Home">
<meta property="og:description" content="一直好奇，怎么用slave模型知道从属线程是否已经结束了分发给他的任务，然后当总认为还没有结束时，主线程可以再次给他分配任务。">
<meta property="og:updated_time" content="2015-05-22T04:59:22.056Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="mpi 求解皇后问题">
<meta name="twitter:description" content="一直好奇，怎么用slave模型知道从属线程是否已经结束了分发给他的任务，然后当总认为还没有结束时，主线程可以再次给他分配任务。">
  
    <link rel="alternative" href="/atom.xml" title="ylw Home" type="application/atom+xml">
  
  
    <link rel="icon" href="img/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  <script src="http://libs.baidu.com/jquery/1.9.0/jquery.js"></script>
</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			<img lazy-src="/img/favicon.png" class="js-avatar">
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">ylw Home</a></h1>
		</hgroup>

		
		<p class="header-subtitle">More Code More Confidence</p>
		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						<div class="icon-wrap icon-link hide" data-idx="2">
							<div class="loopback_l"></div>
							<div class="loopback_r"></div>
						</div>
						
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>菜单</li>
						<li>标签</li>
						
						<li>友情链接</li>
						
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
							<li><a href="/About">ABOUT ME</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="https://github.com/ylwdream" title="github">github</a>
					        
								<a class="weibo" target="_blank" href="http://weibo.com/ylwhere" title="weibo">weibo</a>
					        
								<a class="rss" target="_blank" href="/#" title="rss">rss</a>
					        
								<a class="zhihu" target="_blank" href="/#" title="zhihu">zhihu</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/io/" style="font-size: 10px;">io</a> <a href="/tags/memory/" style="font-size: 10px;">memory</a> <a href="/tags/socket/" style="font-size: 20px;">socket</a>
					</div>
				</section>
				
				
				
				<section class="switch-part switch-part3">
					<div id="js-friends">
					
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://localhost:4000/">奥巴马的博客</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://localhost:4000/">习大大大不同</a>
			        
			        </div>
				</section>
				

				
			</div>
		</div>
	</header>				
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">ylw Home</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img lazy-src="/img/favicon.png" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author">ylw Home</h1>
			</hgroup>
			
			<p class="header-subtitle">More Code More Confidence</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
					<li><a href="/About">ABOUT ME</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/ylwdream" title="github">github</a>
			        
						<a class="weibo" target="_blank" href="http://weibo.com/ylwhere" title="weibo">weibo</a>
			        
						<a class="rss" target="_blank" href="/#" title="rss">rss</a>
			        
						<a class="zhihu" target="_blank" href="/#" title="zhihu">zhihu</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>
      <div class="body-wrap"><article id="post-2014-11-10-mpi-qiu-jie-huang-hou-wen-ti" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2014/11/10/2014-11-10-mpi-qiu-jie-huang-hou-wen-ti/" class="article-date">
  	<time datetime="2014-11-10T09:09:40.000Z" itemprop="datePublished">2014-11-10</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      mpi 求解皇后问题
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
        
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/parallel/">parallel</a>
	</div>


        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>一直好奇，怎么用slave模型知道从属线程是否已经结束了分发给他的任务，然后当总认为还没有结束时，主线程可以再次给他分配任务。<br><a id="more"></a></p>
<p>mpi是消息传递的模型，理论上是可以实现的，今天终于看到了一个例子程序是这么应用的。感到十分的高兴。我在想有一天mpi不是基于smp共享内存的体系结构编程，而是基于网络的，那么估计现在的好多函数都不能用了，我认为mpi的模型肯定是几个线程之间通信用的是共享内存，这样存储数据只要知道数据的地址就可以了，多么方便。可是假如没有使用同一块内存区域，那还怎么搞。。。。</p>
<p>下面这个例子是用mpi求解八皇后的问题，mpi是多么遥远的东西了，我估计现在就我们学校还在学习吧。真正的进程间通信肯定不用mpi编写，有内核对象、管道、共享内存好多机制可以使用。</p>
<p>其中有一点我不明白的是，从属线程是怎么讲结果二维数据发送给主线程的？？</p>
<p>希望有知道的人可以指点下。</p>
<figure class="highlight c"><figcaption><span>queen.c</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;mpi.h&gt;</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;stdio.h&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="preprocessor">#<span class="keyword">define</span> QUEENS 8</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">define</span> MAX_SOLUTIONS 92</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">int</span> <span class="keyword">bool</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> <span class="keyword">true</span> = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> <span class="keyword">false</span> = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*枚举信号*/</span></span><br><span class="line"><span class="keyword">enum</span> msg_content</span><br><span class="line">&#123;</span><br><span class="line">    READY,</span><br><span class="line">    ACCOMPLISHED,</span><br><span class="line">    NEW_TASK,</span><br><span class="line">    TERMINATE</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*枚举信息标签*/</span></span><br><span class="line"><span class="keyword">enum</span> <span class="keyword">msg_t</span>ag</span><br><span class="line">&#123;</span><br><span class="line">    REQUEST_TAG,</span><br><span class="line">    SEED_TAG,</span><br><span class="line">    REPLY_TAG,</span><br><span class="line">    NUM_SOLUTIONS_TAG,</span><br><span class="line">    SOLUTIONS_TAG</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> solutions[MAX_SOLUTIONS][QUEENS];</span><br><span class="line"><span class="keyword">int</span> solution_count = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span><br><span class="line"> *函数名：collides</span><br><span class="line"> *功能：检查两个位置是否有列、对角线或反对角线冲突</span><br><span class="line"> *输入：row1为位置1的行号；</span><br><span class="line"> *      col1为位置1的列号；</span><br><span class="line"> *      row2为位置2的行号；</span><br><span class="line"> *      col2为位置2的列号。</span><br><span class="line"> *输出：返回1代表两位置有行、对角线或反对角线冲突；</span><br><span class="line"> *      否则返回0</span><br><span class="line"> */</span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">collides</span><span class="params">(<span class="keyword">int</span> row1, <span class="keyword">int</span> col1, <span class="keyword">int</span> row2, <span class="keyword">int</span> col2)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (col1 == col2)</span><br><span class="line">        || (col1 - col2 == row1 - row2)</span><br><span class="line">        || (col1 + row1 == col2 + row2);</span><br><span class="line">&#125;                                                 <span class="comment">/* collides */</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span><br><span class="line"> *函数名：generate_seed</span><br><span class="line"> *功能：生成初始化棋盘，只初始化棋盘的前两列</span><br><span class="line"> *输入：无</span><br><span class="line"> *输出：返回0代表已没有可初始化的棋盘，</span><br><span class="line"> *      否则返回生成的初始化的棋盘。</span><br><span class="line"> */</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">generate_seed</span><span class="params">()</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> seed = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">        seed++;</span><br><span class="line">    &#125; <span class="keyword">while</span> (seed &lt;= QUEENS * QUEENS - <span class="number">1</span></span><br><span class="line">        &amp;&amp; collides(<span class="number">0</span>, seed / QUEENS, <span class="number">1</span>, seed % QUEENS));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (seed &gt; QUEENS * QUEENS - <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">return</span> seed;</span><br><span class="line">&#125;                                                 <span class="comment">/* generate_seed */</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span><br><span class="line"> *函数名：print_solutions</span><br><span class="line"> *功能：打印结果</span><br><span class="line"> *输入：count为需要打印的结果的个数；</span><br><span class="line"> *      solutions[][QUEENS]为所要打印出来的结果，即皇后所摆放的位置。</span><br><span class="line"> *输出：无</span><br><span class="line"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">print_solutions</span><span class="params">(<span class="keyword">int</span> count, <span class="keyword">int</span> solutions[][QUEENS])</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i, j, k;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; count; i++)</span><br><span class="line">    &#123;</span><br><span class="line">		<span class="comment">/*打印第i+1个结果*/</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"Solution %d :\n"</span>, i + <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; QUEENS; j++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"%d "</span>, solutions[i][j]);</span><br><span class="line">			<span class="comment">/*打印棋盘，*表示皇后所在位置*/</span></span><br><span class="line">            <span class="keyword">for</span> (k = <span class="number">0</span>; k &lt; solutions[i][j]; k++) <span class="built_in">printf</span>(<span class="string">"- "</span>);</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"* "</span>);</span><br><span class="line">            <span class="keyword">for</span> (k = QUEENS - <span class="number">1</span>; k &gt; solutions[i][j]; k--) <span class="built_in">printf</span>(<span class="string">"- "</span>);</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;                                                 <span class="comment">/* print_solutions */</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span><br><span class="line"> *函数名：is_safe</span><br><span class="line"> *功能：检查当前皇后所摆放的位置是否与已摆放的皇后的位置相冲突</span><br><span class="line"> *输入：chessboard[]为存放皇后所摆放的位置的数组;</span><br><span class="line"> *      row为当前位置的行；</span><br><span class="line"> *      col为当前位置的列。</span><br><span class="line"> *输出：返回0代表当前位置有冲突，不可摆放皇后；</span><br><span class="line">        返回1代表当前位置没有冲突，可以摆放皇后。</span><br><span class="line"> */</span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">is_safe</span><span class="params">(<span class="keyword">int</span> chessboard[], <span class="keyword">int</span> row, <span class="keyword">int</span> col)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; row; i++)</span><br><span class="line">    &#123;</span><br><span class="line">		<span class="comment">/*检查当前位置是否与第i行皇后的位置相冲突*/</span></span><br><span class="line">        <span class="keyword">if</span> (collides(i, chessboard[i], row, col))</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;                                             <span class="comment">/* for */</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;                                                 <span class="comment">/* is_safe */</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span><br><span class="line"> *函数名：place_queens</span><br><span class="line"> *功能：为当前行的皇后寻找适当的摆放位置，</span><br><span class="line"> *      如果皇后摆放完毕则记录所摆放的位置，</span><br><span class="line"> *      递归的摆放后面的皇后，</span><br><span class="line"> *      当所有皇后摆放完毕后，记录所得的解。</span><br><span class="line"> *输入：chessboard[]为存放皇后所摆放位置的数组；</span><br><span class="line">        row为当前皇后所要摆放的行号。</span><br><span class="line"> *输出：无</span><br><span class="line"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">place_queens</span><span class="params">(<span class="keyword">int</span> chessboard[], <span class="keyword">int</span> row)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i, col;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (row &gt;= QUEENS)                            <span class="comment">/*所有皇后均摆放完毕*/</span></span><br><span class="line">    &#123;</span><br><span class="line">		<span class="comment">/* 结束递归并记录当前解 */</span></span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; QUEENS; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            solutions[solution_count][i] = chessboard[i];</span><br><span class="line">        &#125;</span><br><span class="line">        solution_count++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">		<span class="comment">/*还有皇后没有摆好*/</span></span><br><span class="line">        <span class="keyword">for</span> (col = <span class="number">0</span>; col &lt; QUEENS; col++)        <span class="comment">/*在当前行寻找适当位置摆放皇后*/</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (is_safe(chessboard, row, col))    <span class="comment">/*当前位置不冲突*/</span></span><br><span class="line">            &#123;</span><br><span class="line">                chessboard[row] = col;            <span class="comment">/* 在当前位置放置一个皇后 */</span></span><br><span class="line">                place_queens(chessboard, row + <span class="number">1</span>);<span class="comment">/* 递归放置下一个皇后 */</span></span><br><span class="line">            &#125;                                     <span class="comment">/* if */</span></span><br><span class="line">        &#125;                                         <span class="comment">/* for */</span></span><br><span class="line">    &#125;                                             <span class="comment">/* else */</span></span><br><span class="line">&#125;                                                 <span class="comment">/* place_queens */</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span><br><span class="line"> *函数名：sequential_eight_queens</span><br><span class="line"> *功能：串行地求解八皇后问题，并将解打印出来</span><br><span class="line"> *输入：无</span><br><span class="line"> *输出：无</span><br><span class="line"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">sequential_eight_queens</span><span class="params">()</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> chessboard[QUEENS];</span><br><span class="line"></span><br><span class="line">    solution_count = <span class="number">0</span>;</span><br><span class="line">	<span class="comment">/*开始求解八皇后问题*/</span></span><br><span class="line">    place_queens(chessboard, <span class="number">0</span>);</span><br><span class="line">	<span class="comment">/*打印所求结果*/</span></span><br><span class="line">    print_solutions(solution_count, solutions);</span><br><span class="line">&#125;                                                 <span class="comment">/*sequential_eight_queens*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span><br><span class="line"> *函数名：eight_queens_master</span><br><span class="line"> *功能：生成初始化棋盘，并将其发送给空闲的子进程；</span><br><span class="line"> *      从子进程中接受并记录解；</span><br><span class="line"> *      当所有子进程都已终止且没有新的初始化棋盘时，打印所有的解。</span><br><span class="line"> *输入：nodes为工作组中进程数</span><br><span class="line"> *输出：无</span><br><span class="line"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">eight_queens_master</span><span class="params">(<span class="keyword">int</span> nodes)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    MPI_Status status;</span><br><span class="line">    <span class="keyword">int</span> active_slaves = nodes - <span class="number">1</span>;                <span class="comment">// except the master itself</span></span><br><span class="line">    <span class="keyword">int</span> <span class="keyword">new_t</span>ask = NEW_TASK;</span><br><span class="line">    <span class="keyword">int</span> terminate = TERMINATE;</span><br><span class="line">    <span class="keyword">int</span> reply;</span><br><span class="line">    <span class="keyword">int</span> child;</span><br><span class="line">    <span class="keyword">int</span> num_solutions;</span><br><span class="line">    <span class="keyword">int</span> seed;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (active_slaves)                         <span class="comment">/*有未结束的子进程*/</span></span><br><span class="line">    &#123;</span><br><span class="line">		<span class="comment">/*从子进程中接受返回信号*/</span></span><br><span class="line">        MPI_Recv(&amp;reply, <span class="number">1</span>, MPI_INT, MPI_ANY_SOURCE, REPLY_TAG, MPI_COMM_WORLD, &amp;status);</span><br><span class="line"></span><br><span class="line">        child = status.MPI_SOURCE;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (reply == ACCOMPLISHED)                <span class="comment">/*子进程已完成求解任务*/</span></span><br><span class="line">        &#123;</span><br><span class="line">			<span class="comment">/* 从子进程接收并记录解 */</span></span><br><span class="line">            MPI_Recv(&amp;num_solutions, <span class="number">1</span>, MPI_INT, child, NUM_SOLUTIONS_TAG, MPI_COMM_WORLD, &amp;status);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (num_solutions &gt; <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                MPI_Recv(solutions[solution_count],</span><br><span class="line">                    QUEENS * num_solutions, MPI_INT,</span><br><span class="line">                    child, SOLUTIONS_TAG, MPI_COMM_WORLD, &amp;status);</span><br><span class="line">                solution_count += num_solutions;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        seed = generate_seed();                   <span class="comment">/*产生初始棋盘*/</span></span><br><span class="line">        <span class="keyword">if</span> (seed)                                 <span class="comment">/* 还有新的初始棋盘 */</span></span><br><span class="line">        &#123;</span><br><span class="line">			<span class="comment">/* 向子进程发送一个new_task信号 */</span></span><br><span class="line">            MPI_Send(&amp;<span class="keyword">new_t</span>ask, <span class="number">1</span>, MPI_INT, child, REQUEST_TAG, MPI_COMM_WORLD);</span><br><span class="line">			<span class="comment">/* 向子进程发送一个合法的新棋盘 */</span></span><br><span class="line">            MPI_Send(&amp;seed, <span class="number">1</span>, MPI_INT, child, SEED_TAG, MPI_COMM_WORLD);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>                                      <span class="comment">/* 已求出所有解 */</span></span><br><span class="line">        &#123;</span><br><span class="line">			<span class="comment">/* 向子进程发送终止信号 */</span></span><br><span class="line">            MPI_Send(&amp;terminate, <span class="number">1</span>, MPI_INT, child, REQUEST_TAG, MPI_COMM_WORLD);</span><br><span class="line">            active_slaves--;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;                                             <span class="comment">/* while */</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/*打印所有解*/</span></span><br><span class="line">    print_solutions(solution_count, solutions);</span><br><span class="line">&#125;                                                 <span class="comment">/* eight_queens_master */</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span><br><span class="line"> *函数名：eight_queens_slave</span><br><span class="line"> *功能：从主进程接受新的初始化的棋盘；</span><br><span class="line"> *      在初始化的棋盘基础上求出所有合法的解；</span><br><span class="line"> *      将求得的解发送给主进程。</span><br><span class="line"> *输入：my_rank为子进程在整个工作组中的进程标识符</span><br><span class="line"> *输出：无</span><br><span class="line"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">eight_queens_slave</span><span class="params">(<span class="keyword">int</span> my_rank)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    MPI_Status status;</span><br><span class="line">    <span class="keyword">int</span> ready = READY;</span><br><span class="line">    <span class="keyword">int</span> accomplished = ACCOMPLISHED;</span><br><span class="line">    <span class="keyword">bool</span> finished = <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">int</span> request;</span><br><span class="line">    <span class="keyword">int</span> seed;</span><br><span class="line">    <span class="keyword">int</span> num_solutions = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> chessboard[QUEENS];</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*向主进程发送ready信号*/</span></span><br><span class="line">    MPI_Send(&amp;ready, <span class="number">1</span>, MPI_INT, <span class="number">0</span>, REPLY_TAG, MPI_COMM_WORLD);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (! finished)                            <span class="comment">/*子进程未终止*/</span></span><br><span class="line">    &#123;</span><br><span class="line">		<span class="comment">/* 从主进程接收消息 */</span></span><br><span class="line">        MPI_Recv(&amp;request, <span class="number">1</span>, MPI_INT, <span class="number">0</span>, REQUEST_TAG, MPI_COMM_WORLD, &amp;status);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (request == NEW_TASK)</span><br><span class="line">        &#123;</span><br><span class="line">			<span class="comment">/* 从主进程接收初始棋盘 */</span></span><br><span class="line">            MPI_Recv(&amp;seed, <span class="number">1</span>, MPI_INT, <span class="number">0</span>, SEED_TAG, MPI_COMM_WORLD, &amp;status);</span><br><span class="line"></span><br><span class="line">			<span class="comment">/* 在初始棋盘基础上求解 */</span></span><br><span class="line">            chessboard[<span class="number">0</span>] = seed / QUEENS;</span><br><span class="line">            chessboard[<span class="number">1</span>] = seed % QUEENS;</span><br><span class="line"></span><br><span class="line">            solution_count = <span class="number">0</span>;</span><br><span class="line">            place_queens(chessboard, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">			<span class="comment">/* 将解发送给主进程 */</span></span><br><span class="line">            <span class="comment">/*向主进程发送accomplished信号*/</span></span><br><span class="line">            MPI_Send(&amp;accomplished, <span class="number">1</span>, MPI_INT, <span class="number">0</span>, REPLY_TAG, MPI_COMM_WORLD);</span><br><span class="line">            MPI_Send(&amp;solution_count, <span class="number">1</span>, MPI_INT, <span class="number">0</span>, NUM_SOLUTIONS_TAG, MPI_COMM_WORLD);</span><br><span class="line">            <span class="keyword">if</span> (solution_count &gt; <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                MPI_Send(*solutions,</span><br><span class="line">                    QUEENS * solution_count,</span><br><span class="line">                    MPI_INT, <span class="number">0</span>, SOLUTIONS_TAG, MPI_COMM_WORLD);   <span class="comment">//不明白为什么是*solucions？？？ </span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>                                      <span class="comment">/* request == TERMINATE */</span></span><br><span class="line">        &#123;</span><br><span class="line">			<span class="comment">/*主进程要求子进程终止*/</span></span><br><span class="line">            finished = <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;                                             <span class="comment">/* whlie */</span></span><br><span class="line"></span><br><span class="line">&#125;                                                 <span class="comment">/* eight_queens_slave */</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/******************** main ********************/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span><br><span class="line"> *函数名：main</span><br><span class="line"> *功能：启动MPI计算；</span><br><span class="line"> *      确定进程数和进程标识符；</span><br><span class="line"> *      调用主进程和从进程程序并行求解八皇后问题。</span><br><span class="line"> *输入：argc为命令行参数个数；</span><br><span class="line"> *      argv为每个命令行参数组成的字符串数组。</span><br><span class="line"> *输出：返回0代表程序正常结束；否则程序出错。</span><br><span class="line"> */</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>* argv[])</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> nodes, my_rank;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*初始化*/</span></span><br><span class="line">    MPI_Init(&amp;argc, &amp;argv);</span><br><span class="line">	<span class="comment">/*确定工作组中的进程个数*/</span></span><br><span class="line">    MPI_Comm_size(MPI_COMM_WORLD, &amp;nodes);</span><br><span class="line">	<span class="comment">/*确定自己在工作组中的进程标识符*/</span></span><br><span class="line">    MPI_Comm_rank(MPI_COMM_WORLD, &amp;my_rank);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (nodes == <span class="number">1</span>)                               <span class="comment">/*只有一个进程时，用串行算法求解*/</span></span><br><span class="line">    &#123;</span><br><span class="line">        sequential_eight_queens();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*并行求解八皇后问题*/</span></span><br><span class="line">    <span class="keyword">if</span> (! my_rank)</span><br><span class="line">    &#123;</span><br><span class="line">        eight_queens_master(nodes);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        eight_queens_slave(my_rank);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*结束MPI计算*/</span></span><br><span class="line">    MPI_Finalize();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>
    
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2014/11/12/2014-11-12-c-plus-plus-explicitgou-zao-han-shu/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption"><</strong>
      <div class="article-nav-title">
        
          c++ explicit构造函数
        
      </div>
    </a>
  
  
    <a href="/2014/11/09/2014-11-09-mpi-ju-zhen-xiang-cheng/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">MPI 矩阵相乘</div>
      <strong class="article-nav-caption">></strong>
    </a>
  
</nav>

  
</article>


<div class="share">
	<!-- JiaThis Button BEGIN -->
	<div class="jiathis_style">
		<span class="jiathis_txt">分享到：</span>
		<a class="jiathis_button_tsina"></a>
		<a class="jiathis_button_cqq"></a>
		<a class="jiathis_button_douban"></a>
		<a class="jiathis_button_weixin"></a>
		<a class="jiathis_button_tumblr"></a>
		<a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jtico jtico_jiathis" target="_blank"></a>
	</div>
	<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=1405949716054953" charset="utf-8"></script>
	<!-- JiaThis Button END -->
</div>



<div class="duoshuo">
	<!-- 多说评论框 start -->
	<div class="ds-thread" data-thread-key="2014-11-10-mpi-qiu-jie-huang-hou-wen-ti" data-title="mpi 求解皇后问题" data-url="http://ylwhere.tk/2014/11/10/2014-11-10-mpi-qiu-jie-huang-hou-wen-ti/"></div>
	<!-- 多说评论框 end -->
	<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
	<script type="text/javascript">
	var duoshuoQuery = {short_name:"true"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		 || document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
	<!-- 多说公共JS代码 end -->
</div>



</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2015 ylw Home
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">
  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>


<script src="/js/mobile.js" type="text/javascript"></script>
<script src="/js/main.js" type="text/javascript"></script>





<! -- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>



  </div>
</body>
</html>